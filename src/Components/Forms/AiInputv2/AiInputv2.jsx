import { useState,useRef } from 'react'
import "./AiInputv2.css"
import { motion, AnimatePresence } from "framer-motion";

function AiInputv2() {
  const [selectedFiles, setSelectedFiles] = useState([]);

  const [hasText, setHasText] = useState(false);
  const [expanded, setExpanded] = useState(false);
  const [showTools, setshowTools] = useState(false);

  const handleFileChange = (e) => {
    const files = Array.from(e.target.files);
    const imageFiles = files.filter(file => file.type.startsWith("image/"));
    setSelectedFiles(imageFiles);
  };

  const handleClearFile = (indexToRemove) => {
    setSelectedFiles(prev => prev.filter((_, i) => i !== indexToRemove));
  };


  const handleSubmit = (e) => {
    e.preventDefault();
    const input = e.target.elements.input;
    const value = input.value.trim();
    if (value) {
      console.log("Submitted:", value);
      input.value = "";
      input.style.height = "auto";
    }
    // handle your api here 
    setExpanded(false);
    setHasText(false);
    setSelectedFiles(null)
  };

  const handleKeyDown = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      e.target.form.requestSubmit();
    }
  };


  return (
    <>
      <form className="ai_inputv2" onSubmit={handleSubmit}>
        {selectedFiles.length > 0 && (
          <div
            style={{
              display: "flex",
              flexWrap: "wrap",
              gap: "0.5em",
            }}
          >
            {selectedFiles.map((file, index) => (
              <div
                key={index}
                style={{
                  width: "80px",
                  height: "80px",
                  position: "relative",
                  borderRadius: "0.5em",
                  overflow: "hidden",
                  background: "#2c2c2c"
                }}
              >
                <img
                  src={URL.createObjectURL(file)}
                  alt={`preview-${index}`}
                  style={{
                    width: "100%",
                    height: "100%",
                    objectFit: "cover"
                  }}
                />
                <button
                  onClick={() => handleClearFile(index)}
                  style={{
                    position: "absolute",
                    top: "4px",
                    right: "4px",
                    background: "rgba(0, 0, 0, 0.6)",
                    border: "none",
                    color: "#fff",
                    borderRadius: "50%",
                    width: "20px",
                    height: "20px",
                    fontSize: "0.9em",
                    cursor: "pointer"
                  }}
                >
                  âœ•
                </button>
              </div>
            ))}
          </div>
        )}

        <AnimatePresence mode="wait">
          {!hasText && (
            <motion.div
              key={expanded ? "expanded" : "collapsed"}
              initial={{ opacity: 0, y: 5 }}
              animate={{ opacity: 0.5, y: 0 }}
              exit={hasText ? { opacity: 0, y: -5 } : false}
              transition={{ duration: 0.3 }}
              style={{
                position: "absolute",
                top: selectedFiles.length > 0 ? 105 : 16,
                left: 15,
                color: "#343434ff",
                pointerEvents: "none",
                fontSize: "17px",
              }}
            >
              Describe your imagination...
            </motion.div>
          )}
        </AnimatePresence>
        <textarea
          id="input"
          rows={1}
          // placeholder={expanded ? "Search the web" : "Ask anything..."}
          onInput={(e) => {
            const el = e.target;
            el.style.height = "auto";
            const maxHeight = 300 - 32;
            el.style.height = Math.min(el.scrollHeight, maxHeight) + "px";

            setHasText(el.value.trim().length > 0);
          }}
          onKeyDown={handleKeyDown}
        />
        <div className="ai_button_areav2">
          <div className='ai_button_areav2' style={{ width: "fit-content" }}>
            <label style={{ cursor: "pointer", display: "inline-flex", alignItems: "center" }}>
              <input
                type="file"
                style={{ display: "none" }}
                onChange={handleFileChange}
                accept="image/*"
                multiple
              />
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width={24} height={24} color={"#000000ff"} fill={"none"}>
                <path d="M12.001 5.00003V19.002" stroke="#000000ff" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
                <path d="M19.002 12.002L4.99998 12.002" stroke="#000000ff" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
              </svg>
            </label>

            <div style={{ position: "relative", display: "inline-block" }}>
              <button
                type="button"
                onClick={() => setshowTools((prev) => !prev)}
                style={{
                  cursor: "pointer",
                }}
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width={24} height={24} color={"#000000ff"} fill={"none"}>
                  <path d="M6.19351 11.3965L12.192 3.31186C12.6611 2.67957 13.5405 3.07311 13.5405 3.91536V10.1729C13.5405 10.6775 13.8853 11.0865 14.3107 11.0865H17.2283C17.891 11.0865 18.2443 12.0134 17.8065 12.6035L11.808 20.6881C11.3389 21.3204 10.4595 20.9269 10.4595 20.0846V13.8271C10.4595 13.3225 10.1147 12.9135 9.68931 12.9135H6.77173C6.10895 12.9135 5.75566 11.9866 6.19351 11.3965Z" stroke="#000000ff" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"></path>
                </svg>
              </button>
              <AnimatePresence>

                {showTools && (
                  <motion.div
                    initial={{ y: 30, opacity: 0 }}
                    animate={{ y: 0, opacity: 1 }}
                    exit={{ y: 30, opacity: 0 }}
                    transition={{ duration: 0.3, ease: "easeOut" }}

                    className="dropdownBoxv2">
                    <ul className="dropdownListv2">
                      <li className="dropdownItemv2">
                        <button className="dropdownButtonv2">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" color="#000000ff" fill="none">
                            <defs />
                            <path fill="#000000ff" d="M11.501,2.25 C12.031,2.25 12.532,2.25 13.004,2.252 C13.418,2.254 13.752,2.592 13.75,3.006 C13.748,3.42 13.41,3.754 12.996,3.752 C12.528,3.75 12.031,3.75 11.5,3.75 C9.24,3.75 7.62,3.752 6.388,3.917 C5.178,4.08 4.455,4.389 3.922,4.922 C3.389,5.455 3.08,6.178 2.917,7.388 C2.752,8.62 2.75,10.24 2.75,12.5 C2.75,14.76 2.752,16.38 2.917,17.612 C3.08,18.822 3.389,19.545 3.922,20.078 C4.063,20.22 4.218,20.346 4.393,20.457 C4.526,20.296 4.66,20.134 4.795,19.97 C6.715,17.643 8.845,15.063 11.263,13.442 C12.678,12.493 14.235,11.839 15.953,11.758 C17.327,11.694 18.757,11.998 20.25,12.749 L20.25,12.5 C20.25,11.969 20.25,11.472 20.248,11.004 C20.246,10.59 20.58,10.252 20.994,10.25 C21.408,10.248 21.746,10.582 21.748,10.996 C21.75,11.468 21.75,11.969 21.75,12.499 L21.75,12.557 C21.75,14.748 21.75,16.469 21.569,17.812 C21.384,19.189 20.997,20.281 20.139,21.139 C19.281,21.997 18.189,22.384 16.812,22.569 C15.469,22.75 13.748,22.75 11.557,22.75 L11.443,22.75 C9.252,22.75 7.531,22.75 6.188,22.569 C4.811,22.384 3.719,21.997 2.861,21.139 C2.003,20.281 1.616,19.189 1.431,17.812 C1.25,16.469 1.25,14.748 1.25,12.557 L1.25,12.443 C1.25,10.252 1.25,8.531 1.431,7.188 C1.616,5.811 2.003,4.719 2.861,3.861 C3.719,3.003 4.811,2.616 6.188,2.431 C7.531,2.25 9.252,2.25 11.443,2.25 Z M5.889,21.002 C6.046,21.032 6.212,21.059 6.388,21.083 C7.62,21.248 9.24,21.25 11.5,21.25 C13.76,21.25 15.38,21.248 16.612,21.083 C17.822,20.92 18.545,20.611 19.078,20.078 C19.611,19.545 19.92,18.822 20.083,17.612 C20.196,16.769 20.233,15.744 20.244,14.457 C18.687,13.527 17.292,13.197 16.023,13.257 C14.654,13.321 13.358,13.843 12.098,14.688 C9.879,16.176 7.907,18.561 5.97,20.905 C5.943,20.937 5.916,20.97 5.889,21.002 Z M18.5,1.25 C18.814,1.25 19.094,1.445 19.203,1.74 L19.461,2.437 C19.823,3.415 19.939,3.681 20.129,3.871 C20.319,4.061 20.585,4.177 21.563,4.539 L22.26,4.797 C22.555,4.906 22.75,5.186 22.75,5.5 C22.75,5.814 22.555,6.094 22.26,6.203 L21.563,6.461 C20.585,6.823 20.319,6.939 20.129,7.129 C19.939,7.319 19.823,7.585 19.461,8.563 L19.203,9.26 C19.094,9.555 18.814,9.75 18.5,9.75 C18.186,9.75 17.906,9.555 17.797,9.26 L17.539,8.563 C17.177,7.585 17.061,7.319 16.871,7.129 C16.681,6.939 16.415,6.823 15.437,6.461 L14.74,6.203 C14.445,6.094 14.25,5.814 14.25,5.5 C14.25,5.186 14.445,4.906 14.74,4.797 L15.437,4.539 C16.415,4.177 16.681,4.061 16.871,3.871 C17.061,3.681 17.177,3.415 17.539,2.437 L17.797,1.74 C17.906,1.445 18.186,1.25 18.5,1.25 Z M7,5.75 C8.243,5.75 9.25,6.757 9.25,8 C9.25,9.243 8.243,10.25 7,10.25 C5.757,10.25 4.75,9.243 4.75,8 C4.75,6.757 5.757,5.75 7,5.75 Z M18.5,4.083 C18.345,4.412 18.17,4.693 17.932,4.932 C17.693,5.17 17.412,5.345 17.083,5.5 C17.412,5.655 17.693,5.83 17.932,6.068 C18.17,6.307 18.345,6.588 18.5,6.917 C18.655,6.588 18.83,6.307 19.068,6.068 C19.307,5.83 19.588,5.655 19.917,5.5 C19.588,5.345 19.307,5.17 19.068,4.932 C18.83,4.693 18.655,4.412 18.5,4.083 Z M6.25,8 C6.25,8.414 6.586,8.75 7,8.75 C7.414,8.75 7.75,8.414 7.75,8 C7.75,7.586 7.414,7.25 7,7.25 C6.586,7.25 6.25,7.586 6.25,8 Z" />
                          </svg>
                          Image genv7
                        </button>
                      </li>
                      <li className="dropdownItemv2">
                        <button className="dropdownButtonv2">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" color="#000000ff" fill="none">
                            <defs />
                            <path fill="#000000ff" d="M11.501,2.25 C12.031,2.25 12.532,2.25 13.004,2.252 C13.418,2.254 13.752,2.592 13.75,3.006 C13.748,3.42 13.41,3.754 12.996,3.752 C12.528,3.75 12.031,3.75 11.5,3.75 C9.24,3.75 7.62,3.752 6.388,3.917 C5.178,4.08 4.455,4.389 3.922,4.922 C3.389,5.455 3.08,6.178 2.917,7.388 C2.752,8.62 2.75,10.24 2.75,12.5 C2.75,14.76 2.752,16.38 2.917,17.612 C3.08,18.822 3.389,19.545 3.922,20.078 C4.455,20.611 5.178,20.92 6.388,21.083 C7.62,21.248 9.24,21.25 11.5,21.25 C13.76,21.25 15.38,21.248 16.612,21.083 C17.822,20.92 18.545,20.611 19.078,20.078 C19.611,19.545 19.92,18.822 20.083,17.612 C20.248,16.38 20.25,14.76 20.25,12.5 C20.25,11.969 20.25,11.472 20.248,11.004 C20.246,10.59 20.58,10.252 20.994,10.25 C21.408,10.248 21.746,10.582 21.748,10.996 C21.75,11.468 21.75,11.969 21.75,12.499 L21.75,12.557 C21.75,14.748 21.75,16.469 21.569,17.812 C21.384,19.189 20.997,20.281 20.139,21.139 C19.281,21.997 18.189,22.384 16.812,22.569 C15.469,22.75 13.748,22.75 11.557,22.75 L11.443,22.75 C9.252,22.75 7.531,22.75 6.188,22.569 C4.811,22.384 3.719,21.997 2.861,21.139 C2.003,20.281 1.616,19.189 1.431,17.812 C1.25,16.469 1.25,14.748 1.25,12.557 L1.25,12.443 C1.25,10.252 1.25,8.531 1.431,7.188 C1.616,5.811 2.003,4.719 2.861,3.861 C3.719,3.003 4.811,2.616 6.188,2.431 C7.531,2.25 9.252,2.25 11.443,2.25 L11.501,2.25 Z M12.507,9.486 L12.589,9.537 C13.27,9.959 13.839,10.31 14.25,10.638 C14.675,10.975 15.048,11.374 15.182,11.929 C15.273,12.304 15.273,12.697 15.182,13.071 C15.048,13.627 14.675,14.025 14.25,14.362 C13.839,14.69 13.27,15.042 12.589,15.463 L12.589,15.463 L12.589,15.463 L12.507,15.514 C11.85,15.92 11.299,16.261 10.842,16.473 C10.379,16.687 9.85,16.849 9.299,16.679 C8.934,16.567 8.611,16.356 8.355,16.075 C7.983,15.667 7.861,15.132 7.805,14.599 C7.75,14.067 7.75,13.38 7.75,12.543 L7.75,12.457 C7.75,11.62 7.75,10.933 7.805,10.401 C7.861,9.868 7.983,9.334 8.355,8.925 C8.611,8.644 8.934,8.433 9.299,8.321 C9.85,8.151 10.379,8.313 10.842,8.528 C11.299,8.739 11.85,9.08 12.507,9.486 Z M19.203,1.74 L19.461,2.437 C19.823,3.415 19.939,3.681 20.129,3.871 C20.319,4.061 20.585,4.177 21.563,4.539 L22.26,4.797 C22.555,4.906 22.75,5.186 22.75,5.5 C22.75,5.814 22.555,6.094 22.26,6.203 L21.563,6.461 C20.585,6.823 20.319,6.939 20.129,7.129 C19.939,7.319 19.823,7.585 19.461,8.563 L19.203,9.26 C19.094,9.555 18.814,9.75 18.5,9.75 C18.186,9.75 17.906,9.555 17.797,9.26 L17.539,8.563 C17.177,7.585 17.061,7.319 16.871,7.129 C16.681,6.939 16.415,6.823 15.437,6.461 L14.74,6.203 C14.445,6.094 14.25,5.814 14.25,5.5 C14.25,5.186 14.445,4.906 14.74,4.797 L15.437,4.539 C16.415,4.177 16.681,4.061 16.871,3.871 C17.061,3.681 17.177,3.415 17.539,2.437 L17.797,1.74 C17.906,1.445 18.186,1.25 18.5,1.25 C18.814,1.25 19.094,1.445 19.203,1.74 Z M9.741,9.754 C9.644,9.784 9.548,9.843 9.464,9.935 C9.427,9.977 9.344,10.104 9.297,10.557 C9.251,11.001 9.25,11.61 9.25,12.5 C9.25,13.391 9.251,13.999 9.297,14.444 C9.344,14.896 9.427,15.024 9.464,15.065 C9.548,15.157 9.644,15.216 9.741,15.246 C9.75,15.249 9.848,15.28 10.212,15.111 C10.577,14.943 11.05,14.651 11.759,14.212 C12.492,13.759 12.983,13.454 13.317,13.189 C13.647,12.926 13.707,12.79 13.724,12.719 C13.759,12.576 13.759,12.424 13.724,12.281 C13.707,12.21 13.647,12.074 13.317,11.812 C12.983,11.546 12.492,11.241 11.759,10.788 C11.05,10.349 10.577,10.058 10.212,9.889 C9.849,9.72 9.75,9.752 9.741,9.754 Z M17.932,4.932 C17.693,5.17 17.412,5.345 17.083,5.5 C17.412,5.655 17.693,5.83 17.932,6.068 C18.17,6.307 18.345,6.588 18.5,6.917 C18.655,6.588 18.83,6.307 19.068,6.068 C19.307,5.83 19.588,5.655 19.917,5.5 C19.588,5.345 19.307,5.17 19.068,4.932 C18.83,4.693 18.655,4.412 18.5,4.083 C18.345,4.412 18.17,4.693 17.932,4.932 Z" />
                          </svg>
                          Video Genv3
                        </button>
                      </li>
                    </ul>
                  </motion.div>

                )}
              </AnimatePresence>
            </div>

          </div>
          <div className="ai_button_areav2">

            <button type='button'>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width={24} height={24} color={"#000000ff"} fill={"none"}>
                <path d="M17 7V11C17 13.7614 14.7614 16 12 16C9.23858 16 7 13.7614 7 11V7C7 4.23858 9.23858 2 12 2C14.7614 2 17 4.23858 17 7Z" stroke="#000000ff" strokeWidth="1.5" />
                <path d="M20 11C20 15.4183 16.4183 19 12 19M12 19C7.58172 19 4 15.4183 4 11M12 19V22M12 22H15M12 22H9" stroke="#000000ff" strokeWidth="1.5" strokeLinecap="round" />
              </svg>
            </button>
            <button type="submit">
              <svg viewBox="0 0 24 24" width="23" height="23" color="#000000ff" fill="none">
                <defs />
                <path  strokeWidth="2" fill="#000000ff" d="M11.171,13.174 C11.121,13.15 11.073,13.119 11.028,13.083 C10.913,13.024 10.739,12.957 10.465,12.88 C10.152,12.792 9.678,12.696 9.08,12.574 L9.08,12.574 C8.896,12.536 8.701,12.497 8.495,12.454 C7.643,12.278 6.653,12.06 5.712,11.779 C4.78,11.501 3.843,11.147 3.123,10.676 C2.418,10.215 1.756,9.528 1.75,8.556 C1.748,8.185 1.921,7.878 2.086,7.662 C2.259,7.436 2.489,7.223 2.741,7.026 C3.247,6.629 3.944,6.216 4.746,5.808 C6.359,4.989 8.513,4.133 10.722,3.422 C12.93,2.711 15.229,2.133 17.131,1.884 C18.08,1.759 18.961,1.712 19.697,1.783 C20.397,1.851 21.13,2.039 21.597,2.543 C22.051,3.031 22.2,3.766 22.239,4.465 C22.28,5.202 22.206,6.082 22.057,7.03 C21.758,8.931 21.137,11.217 20.392,13.41 C19.646,15.603 18.765,17.735 17.933,19.325 C17.519,20.116 17.103,20.801 16.707,21.295 C16.51,21.541 16.298,21.767 16.072,21.934 C15.857,22.094 15.544,22.265 15.168,22.249 C14.564,22.222 14.105,21.891 13.768,21.453 C13.444,21.034 13.189,20.465 12.962,19.807 C12.507,18.489 12.08,16.545 11.529,14.039 C11.41,13.501 11.311,13.318 11.221,13.222 C11.207,13.206 11.191,13.19 11.171,13.174 Z M3.278,8.573 C3.268,8.586 3.26,8.598 3.254,8.607 C3.28,8.817 3.443,9.092 3.944,9.421 C4.481,9.772 5.253,10.077 6.14,10.342 C7.017,10.603 7.956,10.81 8.799,10.985 C8.98,11.023 9.159,11.059 9.333,11.094 L9.333,11.094 C9.946,11.219 10.499,11.332 10.87,11.436 C11.035,11.482 11.195,11.532 11.35,11.59 L14.47,8.47 C14.763,8.177 15.237,8.177 15.53,8.47 C15.823,8.763 15.823,9.237 15.53,9.53 L12.554,12.507 C12.776,12.86 12.896,13.274 12.994,13.717 C13.554,16.264 13.961,18.102 14.38,19.318 C14.59,19.927 14.783,20.313 14.956,20.538 C15.053,20.663 15.123,20.714 15.17,20.735 L15.177,20.73 C15.26,20.669 15.381,20.552 15.536,20.358 C15.845,19.972 16.209,19.385 16.604,18.629 C17.39,17.127 18.243,15.07 18.972,12.927 C19.7,10.783 20.294,8.584 20.575,6.797 C20.716,5.901 20.774,5.137 20.741,4.548 C20.706,3.921 20.576,3.647 20.498,3.563 C20.421,3.48 20.166,3.335 19.553,3.276 C18.976,3.221 18.22,3.254 17.326,3.371 C15.545,3.605 13.34,4.155 11.182,4.85 C9.025,5.544 6.949,6.371 5.426,7.146 C4.661,7.535 4.062,7.897 3.666,8.207 C3.467,8.362 3.345,8.486 3.278,8.573 Z M15.121,20.766 L15.125,20.764 C15.123,20.765 15.121,20.766 15.121,20.766 Z" />
              </svg>
            </button>
          </div>
        </div>
      </form >

    </>
  )
}

export default AiInputv2